pipeline {
    agent any
    environment {
        AWS_SECRET_KEY = credentials('aws_secret_key')
        AWS_ACCESS_KEY = credentials('aws_access_key')
    }
        stages {
            stage ('Install Terraform') {
                steps {
                    sh 'docker pull hashicorp/terraform'
                }
            }

            stage('Install Additional Packages') {
                steps {
                    // Install any additional dependencies required by Terraform
                    sh 'sudo apt-get update && sudo apt-get install -y gnupg software-properties-common'
                }
            }

            stage ('Terraform Init') {
                steps {
                    dir("Jenkins_DockerAgent/terraform") {
                        sh 'terraform init'
                    }
                }
            }

            stage ('Terraform Plan') {
                steps {
                    dir("Jenkins_DockerAgent/terraform") {
                        sh 'terraform plan'
                    }
                }
            }
            stage ('Terraform Apply') {
                steps {
                    dir("Jenkins_DockerAgent/terraform") {
                        sh 'terraform apply "aws_access_key=${AWS_ACCESS_KEY}" -var="aws_secret_key=${AWS_SECRET_KEY}" -auto-approve'
                    }
                }
            }
    }
}